---
title: マルチサーバー
createTime: 2025/02/24 16:08:34
permalink: /jp/notes/doc/owner/other/multi-server/
---

:::: info
このページはGitHub Copilotによって翻訳されました。文法的な誤りや不自然な表現が含まれている可能性があります。
翻訳の改善にご協力いただける場合は、[Language](/jp/notes/doc/owner/config-ref/languages/)をご参照ください。
::::

::: warning
1. この機能はまだ実験段階にあります;
2. 潜在的な問題に対処できる場合にのみこの機能を使用してください;
3. データベースを定期的にバックアップしてデータ損失を防いでください;
:::

## 紹介

グループサーバーを構成することで、複数のサーバーを同じデータベースに接続し、クロスサーバーのテレポート、クロスサーバーの領地管理などの機能を利用できます。

## 前提条件

- [Dominionの設定ファイル構造](/jp/notes/doc/owner/config-ref/overview/)を理解し、基本設定を完了すること;
- サーバーがグループサーバーであり、BungeeCordまたはVelocityで構成されていること;
- MySQLまたはPgSqlデータベースを準備すること;

## 設定方法

これまでに発生した問題に基づいて、次の3つのシナリオが考えられます:

1. 低いバージョンから4にアップグレードし、すでに使用中（データが生成されている）;
2. Dominionを新規インストールし、まだ使用していない（データが生成されていない）;

### シナリオ1

以前にSqLiteを使用していた場合、まず`/dom export db`を使用してデータベースをエクスポートし、新しいMySQLまたはPgSqlデータベースを設定してサーバーを一度起動し、
`/dom import db`を使用してデータベースをインポートします。サーバーをシャットダウンし、[シナリオ2](#Scenario-Two)
に従って設定を続行します。

以前のデータベースがMySQLまたはPgSqlであった場合は、直接[シナリオ2](#Scenario-Two)を参照して設定し、他のサブサーバーを追加できます。

::: warning
このサーバー設定ファイルの`server-id`は変更できません！

現在のデータベースの領地はすべてこの`server-id`に設定されているため、これを変更すると元のデータが見つからなくなります。
:::

::: info
以前に複数のサブサーバーがあり、それぞれに独自の領地データがあった場合、残念ながら現在、複数のサブサーバーのデータを1つのデータベースに安全に統合する方法はありません。
サーバーの1つの領地データのみを保持することができます。
:::

### シナリオ2

#### 1. データベースの設定

まず、データベースを設定します。MySQLまたはPgSqlのいずれかを選択し、すべてのサブサーバーの`plugins/Dominion/config.yml`
ファイルに同じデータベース情報を設定して、すべてのサーバーを同じデータベースに接続します。

::: warning
設定後すぐにサーバーを起動しないでください！
:::

#### 2. サーバー情報の設定

次に、各サブサーバーの`plugins/Dominion/config.yml`ファイルにサーバー情報を設定します：

```yaml
multi-server:
  enable: true
  server-name: server
  server-id: 1
```

それぞれの設定項目について:

- `multi-server.enable`: グループサーバー機能を有効にするには`true`に設定します;
- `multi-server.server-name`: サーバー名で、BungeeCordまたはVelocityのサーバー名と一致させる必要があります;
- `multi-server.server-id`: Dominionが異なるサーバーを区別するために内部で使用するサーバーIDです。この値は正の整数であり、すべてのサーバー間で一意である必要があります;

#### 3. サーバーの起動

最後に、すべてのサーバーがデータベース情報とサーバー情報を設定していることを確認し、すべてのサーバーを起動します。

